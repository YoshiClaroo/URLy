<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="google-adsense-account" content="ca-pub-3539363562189833">
  <title>Acortador de URL | URLy</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: white;
      color: #1e40af;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
      max-width: 800px;
      margin: 0 auto;
    }
    h1 {
      text-align: center;
    }
    .input-group {
      display: flex;
      flex-direction: column;
      width: 100%;
      max-width: 500px;
    }
    input, button {
      padding: 12px;
      margin: 8px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    button {
      background: #1e40af;
      color: white;
      cursor: pointer;
      border: none;
    }
    #shortUrl {
      margin: 20px 0;
      text-align: center;
    }
    .view-all-btn {
      display: inline-block;
      background: #1e40af;
      color: white;
      padding: 12px 24px;
      border-radius: 6px;
      text-decoration: none;
      margin-top: 20px;
    }
    .faq {
      margin-top: 40px;
      text-align: left;
    }
    #cookie-banner {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #1e40af;
      color: white;
      padding: 16px;
      text-align: center;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <h1>Acortador de URL</h1>
  
  <div class="input-group">
    <input type="text" id="longUrl" placeholder="Pega tu URL larga aquÃ­">
    <input type="text" id="alias" placeholder="Alias personalizado (opcional)">
    <button id="shortenBtn">Acortar URL</button>
  </div>

  <div id="shortUrl"></div>
  
  <a href="urls.html" class="view-all-btn">Ver todas las URLs acortadas</a>

  <div class="faq">
    <h2>Preguntas Frecuentes</h2>
    <p><strong>Â¿Es gratis?</strong> SÃ­, nuestro servicio es 100% gratuito.</p>
    <p><strong>Â¿Se guardan mis URLs?</strong> SÃ­, puedes consultarlas cuando quieras.</p>
  </div>

  <footer>
    <a href="terminos.html">TÃ©rminos</a> | 
    <a href="privacidad.html">Privacidad</a>
  </footer>

  <div id="cookie-banner">
    Usamos cookies para mejorar tu experiencia. 
    <a href="privacidad.html#cookies" style="color: #a7c3ff;">MÃ¡s informaciÃ³n</a>.
    <button onclick="acceptCookies()">Aceptar</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAt79jrJpE2OZgb9MunFkjREeB3t4_Vznk",
      authDomain: "urlyi-b3947.firebaseapp.com",
      projectId: "urlyi-b3947",
      storageBucket: "urlyi-b3947.appspot.com",
      messagingSenderId: "732077984332",
      appId: "1:732077984332:web:840e5c1eb645999ede82e9",
      measurementId: "G-VPHWGQG61Q"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Cookies
    if (!localStorage.getItem('cookies-accepted')) {
      document.getElementById('cookie-banner').style.display = 'block';
    }

    window.acceptCookies = () => {
      localStorage.setItem('cookies-accepted', 'true');
      document.getElementById('cookie-banner').style.display = 'none';
    };

    // Acortador
    document.getElementById("shortenBtn").addEventListener("click", async () => {
      const longUrl = document.getElementById("longUrl").value.trim();
      const alias = document.getElementById("alias").value.trim();

      if (!longUrl) {
        alert("Por favor ingresa una URL vÃ¡lida");
        return;
      }

      const shortId = alias || Math.random().toString(36).substring(2, 8);
      const ref = doc(db, "urls", shortId);

      if ((await getDoc(ref)).exists()) {
        alert("Â¡Este alias ya estÃ¡ en uso!");
        return;
      }

      await setDoc(ref, {
        longUrl,
        clicks: 0,
        createdAt: serverTimestamp()
      });

      const shortUrl = `${window.location.origin}/r/${shortId}`;
      document.getElementById("shortUrl").innerHTML = `
        <p>Tu URL acortada:</p>
        <div style="display:flex;gap:10px;justify-content:center">
          <a href="${shortUrl}" target="_blank" style="color:#1e40af">${shortUrl}</a>
          <button onclick="navigator.clipboard.writeText('${shortUrl}')">ðŸ“‹</button>
        </div>
      `;
    });
  </script>
</body>
</html>
